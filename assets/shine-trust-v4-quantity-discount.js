"use strict";!function(t){const e=setInterval((()=>{window.ST_GLOBALS&&(clearInterval(e),o().then((()=>console.info("ST Quantity Discount loaded"))))})),n={variants:[],availabilityMessage:(e,n="error",i="")=>{let a="Thereâ€™s not enough items in our stock, please select smaller bundle";i&&(a=i);const s=e.querySelector(".st-quantity-discount-msg");if("error"===n){if(null===s){const n=t.createElement("div");n.classList.add("st-quantity-discount-msg"),n.classList.add("st-show"),n.innerText=a,e.appendChild(n)}else s.innerText=a,s.classList.add("st-show");e.classList.add("st-error")}else null!==s&&(e.classList.remove("st-error"),s.classList.remove("st-show"),s.innerText="")},calculatorSinglePrice:(t,e,n,i)=>{const a=parseFloat(t),s=parseInt(e);if("percent"===i){return{discountPrice:a*e-a*s*(parseFloat(n)/100),totalPrice:a*s}}if("amount"===i){return{discountPrice:a*s-parseFloat(n),totalPrice:a*s}}},calculatorPrice:(t,e,n)=>{const i=parseFloat(t);if("percent"===n){return i-i*(parseFloat(e)/100)}if("amount"===n){return i-parseFloat(e)}},calculatorVariant:(t,e)=>{const i={},a=t.querySelectorAll(".quantity-discount-item");n.availabilityMessage(t,"success");for(let s=0;s<a.length;s++){const o=a[s].getAttribute("data-id"),r=a[s].querySelectorAll(".quantity-discount-item-variant-item");for(let a=0;a<r.length;a++){const s=r[a].querySelectorAll("select.st_quantity_discount_option"),l=[];for(let t=0;t<s.length;t++)l.push(s[t].value.toString().trim());const c=l.join("-");let u=0;for(const t in e.variants){const n=e.variants[t];n.options.join("-")===c&&(u+=1,i.hasOwnProperty(o)?(i[o].count+=1,i[o].totalPrice+=parseFloat(n.price),i[o].variants.hasOwnProperty(n.id)?i[o].variants[n.id].count+=1:i[o].variants[n.id]={count:1,inventory:parseInt(n.inventory_quantity),inventory_management:n.inventory_management,available:n.available}):i[o]={variants:{[n.id]:{count:1,inventory:parseInt(n.inventory_quantity),inventory_management:n.inventory_management,available:n.available}},count:1,totalPrice:parseFloat(n.price),hasSale:n.has_sale,inventory_management:n.inventory_management,inventory:parseInt(n.inventory_quantity),available:n.available})}u||n.availabilityMessage(t,"error","This variant is not available")}}return i},renderCartForm(e,n=!0,i){const a=this,s=t.querySelector(window.ST_GLOBALS.selectorForm),o=t.querySelectorAll('input[name="quantity"][type="number"],input[name="quantity"][type="text"]');if(null!==s){const r=s.querySelector("button.shopify-payment-button__button"),l=s.querySelector('input[name="id"]')||s.querySelector('select[name="id"]'),c=s.querySelectorAll('[name^="items"]');let u=s.querySelector('input[name="quantity"]');if(r&&(r.style.display=""),null===u){const e=t.createElement("INPUT");e.type="hidden",e.name="quantity",s.prepend(e),u=e}if(l.removeAttribute("disabled"),u.removeAttribute("disabled"),c.length)for(let t=0;t<c.length;t++)c[t].remove();if(a.variants=[],null!==e&&n){const{variants:n}=e;if(1===Object.keys(n).length){s.setAttribute("data-has-variant",0);for(const t in n){if(l.value=t,u.value=n[t].count,u.dispatchEvent(new Event("change",{bubbles:!0})),"hidden"===u.type.toLowerCase()&&u.remove(),o.length)for(let e=0;e<o.length;e++)o[e].value=parseInt(n[t].count),o[e].value=parseInt(n[t].count),o[e].dispatchEvent(new Event("change",{bubbles:!0})),s.setAttribute("data-quantity",parseInt(n[t].count));a.variants.push({quantity:u.value,id:l.value.toString().trim()})}}else{l.setAttribute("disabled","disabled"),u.setAttribute("disabled","disabled"),r&&(r.style.display="none"),s.setAttribute("data-has-variant",1);let e=0;for(const i in n){const r=t.createElement("INPUT");r.type="hidden",r.name=`items[${e}][id]`,r.value=i,s.prepend(r);const l=t.createElement("INPUT");if(l.type="hidden",l.name=`items[${e}][quantity]`,l.value=n[i].count,"hidden"===u.type.toLowerCase()&&u.remove(),o.length)for(let t=0;t<o.length;t++)o[t].value=parseInt(n[i].count),o[t].dispatchEvent(new Event("change",{bubbles:!0})),s.setAttribute("data-quantity",parseInt(n[i].count));a.variants.push({quantity:n[i].count,id:i.toString().trim()}),s.prepend(l),e++}}}else{if(u.value=parseInt(i),u.dispatchEvent(new Event("change",{bubbles:!0})),"hidden"===u.type.toLowerCase()&&u.remove(),o.length)for(let t=0;t<o.length;t++)o[t].value=parseInt(i),o[t].dispatchEvent(new Event("change",{bubbles:!0})),s.setAttribute("data-quantity",parseInt(i));a.variants.push({quantity:parseInt(i),id:l.value.toString().trim()})}}}};class i{constructor(e,n){this.quantityDiscount=e,this.product=n,this.quantityDiscountEl=t.createElement("div"),this.quantityDiscountEl.classList.add("st-quantity-discount-block"),this.quantityDiscountEl.innerHTML=this.html(),this.events()}html(){const{quantityDiscountID:t,editorData:{heading:e,discountObjects:n,canChooseVariant:i}}=this.quantityDiscount;let a="";const{options:s,has_only_default_variant:o}=this.product;for(const t in s){a+=`\n                    <select class="st_quantity_discount_option" name="st_quantity_discount_options[${s[t].name}]">\n                `;for(let e in s[t].values){const n=s[t].values[e].replace('"',"&#x22;").replace("&#x22;","&#x27;");a+=`\n                        <option value="${n}">${n}</option>\n                    `}a+="\n                    </select>"}let r="";return n.length&&n.map(((t,e)=>{const n=parseInt(t.quantity);let s="";for(let t=1;t<=n;t++)s+=`\n                                <div class="quantity-discount-item-variant-item">\n                                    <div class="stt">#${t}</div>\n                                    ${a}\n                                </div>\n                            `;const l=window.ST_GLOBALS.translate(t.label),c=window.ST_GLOBALS.translate(t.title),u=window.ST_GLOBALS.translate(t.total);let d=window.ST_GLOBALS.translate(t.save);d="percent"===t.discountType?d.replace("{{DISCOUNT}}",`${t.discount}%`):d.replace("{{DISCOUNT}}",window.ST_GLOBALS.formatMoney(t.discount)),r+=`<div class="quantity-discount-item ${t.default?"active":""}" \n                            data-id="${t.itemID}"\n                            data-quantity="${t.quantity.toString().trim()}" \n                            data-discount="${t.discount.toString().trim()}"\n                            data-discount-type="${t.discountType}"\n                            >\n                            <div class="quantity-discount-item-heading">\n                                <div class="quantity-discount-item-label">\n                                     <span class="quantity-discount-input"></span>\n                                     ${""!==l?'<span class="quantity-discount-label">'+l+"</span>":""}\n                                     ${""!==c?'<span class="quantity-discount-title">'+c+"</span>":""}\n                                </div>\n                                <div class="quantity-discount-item-price">\n                                    ${""!==d?'<span class="quantity-discount-label-sale">'+d+"</span>":""}\n                                    <div class="quantity-discount-total-price">\n                                        ${""!==u?'<span class="quantity-discount-total-label">'+u+"</span>":""}\n                                        <span class="main-price"></span>\n                                        <span class="discount-price"></span>\n                                    </div>\n                                        \n                                </div>\n                            </div>\n                            <div class="quantity-discount-item-variant ${o?"one-variant":""} ${i?"can-choose-variant":""}">${s}</div>\n                        </div>`})),`\n                <div id="st-quantity-discount-${t}" class="quantity-discount-wrapper">\n                    <h2 class="quantity-discount-heading">${window.ST_GLOBALS.translate(e)}</h2>\n                    <div class="quantity-discount-items">${r}</div>\n                </div>\n            `}events(){const e=this,{has_only_default_variant:i,variant:a}=e.product,{editorData:{canChooseVariant:s}}=e.quantityDiscount,o=n.calculatorVariant(e.quantityDiscountEl,e.product),r=e.quantityDiscountEl.querySelectorAll(".quantity-discount-item");for(let t=0;t<r.length;t++){const l=r[t].getAttribute("data-id"),c=r[t].querySelector(".quantity-discount-item-label");if(c.addEventListener("click",(function(t){n.availabilityMessage(e.quantityDiscountEl,"success");for(let t=0;t<r.length;t++)r[t].classList.remove("active");c.closest(".quantity-discount-item").classList.add("active");const a=c.closest(".quantity-discount-item"),o=a.getAttribute("data-id"),l=a.getAttribute("data-quantity")||1;if(i||!s)n.renderCartForm(null,s,l);else{const t=n.calculatorVariant(e.quantityDiscountEl,e.product);if(t.hasOwnProperty(o)){const i=t[o].variants;for(const t in i)(""===i[t].inventory_management&&!i[t].available||""!==i[t].inventory_management&&i[t].available&&i[t].inventory>0&&i[t].count>i[t].inventory)&&n.availabilityMessage(e.quantityDiscountEl,"error");n.renderCartForm(t[o],s,l)}else n.availabilityMessage(e.quantityDiscountEl,"error","This variant is not available")}})),i){const e=r[t].getAttribute("data-quantity"),i=r[t].getAttribute("data-discount"),s=r[t].getAttribute("data-discount-type"),o=window.ST_GLOBALS.fixPrice(a.price),l=n.calculatorSinglePrice(o,e,i,s);r[t].querySelector(".discount-price").innerHTML=window.ST_GLOBALS.formatMoney(l.discountPrice),r[t].querySelector(".main-price").innerHTML=window.ST_GLOBALS.formatMoney(l.totalPrice)}else if(o.hasOwnProperty(l)){const e=r[t].getAttribute("data-discount"),i=r[t].getAttribute("data-discount-type"),a=window.ST_GLOBALS.fixPrice(o[l].totalPrice),s=n.calculatorPrice(a,e,i);r[t].querySelector(".discount-price").innerHTML=window.ST_GLOBALS.formatMoney(s),r[t].querySelector(".main-price").innerHTML=window.ST_GLOBALS.formatMoney(a)}else n.availabilityMessage(e.quantityDiscountEl,"error","This variant is not available");const u=r[t].querySelectorAll("select.st_quantity_discount_option");if(u.length)for(let t=0;t<u.length;t++)u[t].addEventListener("change",(function(t){n.availabilityMessage(e.quantityDiscountEl,"success");const a=n.calculatorVariant(e.quantityDiscountEl,e.product);if(a.hasOwnProperty(l)){const o=t.target.closest(".quantity-discount-item"),r=o.getAttribute("data-discount"),c=o.getAttribute("data-discount-type"),u=window.ST_GLOBALS.fixPrice(a[l].totalPrice),d=n.calculatorPrice(u,r,c);o.querySelector(".discount-price").innerHTML=window.ST_GLOBALS.formatMoney(d),o.querySelector(".main-price").innerHTML=window.ST_GLOBALS.formatMoney(u);const y=o.getAttribute("data-id"),p=o.getAttribute("data-quantity")||1;if(i||!s)n.renderCartForm(null,s,p);else if(a.hasOwnProperty(y)){const t=a[y].variants;for(const i in t)(""===t[i].inventory_management&&!t[i].available||""!==t[i].inventory_management&&t[i].available&&t[i].inventory>0&&t[i].count>t[i].inventory)&&n.availabilityMessage(e.quantityDiscountEl,"error");n.renderCartForm(a[y],s,p)}}}))}let l=t.URL,c=null;setInterval((()=>{const n=t.URL,i=new URL(n);c=i.searchParams.get("variant")||null,c&&l!==n&&(l=n,e.changeVariantEvent(c))}),100),setTimeout((()=>{n.availabilityMessage(e.quantityDiscountEl,"success");const t=new URL(l);if(c=t.searchParams.get("variant")||null,c)e.changeVariantEvent(c);else{const t=e.quantityDiscountEl.querySelector(".quantity-discount-item.active");if(t){const a=t.getAttribute("data-id"),r=t.getAttribute("data-quantity")||1;if(i||!s)n.renderCartForm(null,s,r);else if(o.hasOwnProperty(a)){const t=o[a].variants;for(const i in t)(""===t[i].inventory_management&&!t[i].available||""!==t[i].inventory_management&&t[i].available&&t[i].inventory>0&&t[i].count>t[i].inventory)&&n.availabilityMessage(e.quantityDiscountEl,"error");n.renderCartForm(o[a],s,r)}}}}),parseInt(ST_META_DATA?.variantTimeout)||500)}changeVariantEvent(t){t=parseInt(t);const e=this,n=e.quantityDiscountEl.querySelectorAll(".quantity-discount-item");for(let i=0;i<n.length;i++){const a=n[i].classList.contains("active"),s=n[i].querySelectorAll(".quantity-discount-item-variant-item");for(const n in e.product.variants){const i=e.product.variants[n];if(i.id===t){const{options:t}=i;for(let e=0;e<s.length;e++){const n=s[e].querySelectorAll("select");for(let e=0;e<n.length;e++)n[e].value=t[e],a&&n[e].dispatchEvent(new Event("change"))}}}}}render(){return{quantityDiscountData:this.quantityDiscount,quantityDiscountEl:this.quantityDiscountEl}}}let a=null;const s={},o=async function(){if(!window.ST_PLAN||"Advanced"!==window.ST_PLAN?.name||"ACTIVE"!==window.ST_PLAN?.status)return;if(a=window.ST_GLOBALS.getBaseCDN(),"product"!==window.ST_GLOBALS.pageType)return;const e=window.ST_QUANTITY_DISCOUNTS||[];if(0===e.length)return;const o={};let l="";if(e.map(((t,e)=>{const{id:n,status:a,cssRender:r,editorData:c,productFilters:u,selectedProducts:d}=t;if(a){const{fontFamily:e,headingFontWeight:a,titleFontWeight:y,priceFontWeight:p,variantFontWeight:v}=c;l+=r,e?.fontFamily&&(o.hasOwnProperty(e.fontFamily)?o[e.fontFamily]={...o[e.fontFamily],headingFontWeight:a,titleFontWeight:y,priceFontWeight:p,variantFontWeight:v}:o[e.fontFamily]={headingFontWeight:a,titleFontWeight:y,priceFontWeight:p,variantFontWeight:v});const m=window.ST_GLOBALS.convertFilters(u,d),h=window.ST_GLOBALS.product||null;if(h){let{published_at:e,on_sale:a,inventory:o,collections:r,tags:l,title:c,id:u,available:d,price_min:y,price_max:p,vendor:v,type:g}=h;y=window.ST_GLOBALS.fixPrice(y),p=window.ST_GLOBALS.fixPrice(p);let S=!1;if(!m?.type&&m.select_all&&0===Object.keys(m.filters).length&&null===m.collection)S=!0;else if(m.select_all&&m.collection&&r.includes(m.collection))S=!0;else if(!m.select_all&&m.products.size)m.products.has(u)&&(S=!0);else if(m.select_all&&Object.keys(m.filters).length){let t=0,e=Object.keys(m.filters).length;for(const e in m.filters)"_s"===e&&c.includes(m.filters[e])&&(t+=1),"price"===e&&!isNaN(y)&&!isNaN(p)&&y>=m.filters[e].min&&p<=m.filters[e].max&&(t+=1),"tag"===e&&l.includes(`${m.filters.tag}`)&&(t+=1),"vendor"===e&&v===m.filters.vendor&&(t+=1),"type"===e&&g===m.filters.type&&(t+=1),"inventory"===e&&("instock"===m.filters.inventory.type&&d&&(t+=1),"outstock"!==m.filters.inventory.type||d||(t+=1),"less-than"===m.filters.inventory.type&&d&&!isNaN(o)&&o<=m.filters.inventory.lte&&(t+=1),"great-than"===m.filters.inventory.type&&d&&!isNaN(o)&&o>=m.filters.inventory.gte&&(t+=1));t===e&&(S=!0)}else if(m.type)if("new-arrival"===m.type){const t=window.ST_GLOBALS.dateWithTimeZone(e,window.ST_META_DATA.timeZone),n=window.ST_GLOBALS.dateWithTimeZone(m.date,window.ST_META_DATA.timeZone);t.getTime()>=n.getTime()&&(S=!0)}else"on-sale"===m.type&&a||"low-stock"===m.type&&o>0&&o<=m.quantity?S=!0:"out-stock"!==m.type||d||(S=!0);S&&(s[n]=new i(t,window.ST_GLOBALS.product).render())}}})),Object.keys(o).length){const t=Object.keys(o).map((t=>({fontFamily:t,fontWeight:[...new Set([parseInt(o[t].headingFontWeight),parseInt(o[t].titleFontWeight),parseInt(o[t].priceFontWeight),parseInt(o[t].variantFontWeight)])].filter((t=>!isNaN(t)&&t>0)).sort((function(t,e){return t-e})).join(";")})));t.length&&t.map((t=>{window.ST_LOADED_FONTS.includes(t.fontFamily)||window.ST_GLOBALS.loadFont(t)}))}l&&window.ST_GLOBALS.addStyle(l);for(const e in s){const{quantityDiscountEl:i,quantityDiscountData:a={}}=s[e],{id:o,quantityDiscountID:l=""}=a,c=t.querySelector('input[type="text"][name="quantity"]:not(.st-sticky-cart-input), input[type="number"][name="quantity"]:not(.st-sticky-cart-input)');if(c){let e=c.parentNode;const n=c.closest(".product-form__quantity");n?(e=n,n.style.display="none"):e?e.style.display="none":c.style.display="none";const a=e.parentNode,s=e.nextSibling,o=t.createDocumentFragment().appendChild(i);s?a.insertBefore(o,s):a.appendChild(o),a.classList.add(`st-quantity-${l}`)}else{const e=t.querySelector(window.ST_GLOBALS.selectorForm);if(e){let n=e;const a=n.parentNode,s=t.createDocumentFragment().appendChild(i);a.insertBefore(s,n)}}r(o);const u=t.querySelector(window.ST_GLOBALS.selectorForm);if(u){const t=u.querySelector('[type="submit"]');t&&t.addEventListener("click",(function(){fetch(window.ST_GLOBALS.apiUrl+"statistic",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:window.ST_GLOBALS.shopDomain,serviceItemID:o,serviceType:"quantity-discount",variants:n.variants})}).then((t=>t.json())).then((async({data:t})=>{})).catch((t=>console.log(t)))}))}}},r=function(t){fetch(window.ST_GLOBALS.apiUrl+"total-views",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:window.ST_GLOBALS.shopDomain,serviceItemID:t,serviceType:"quantity-discount"})}).then((t=>t.json())).then((async()=>{})).catch((t=>console.log(t)))}}(window.document);